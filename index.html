<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kiki Learns to Read</title>

<style>
body{
  font-family:"Arial Rounded MT Bold",Arial,sans-serif;
  background:#fff0fa;
  margin:0;
  padding:16px;
  max-width:480px;
  margin:auto;
}
h1,h2{text-align:center}
.panel{
  background:white;
  border-radius:18px;
  padding:16px;
  margin-bottom:18px;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
}
.hidden{display:none}

button{
  padding:12px;
  width:100%;
  border:none;
  border-radius:14px;
  background:#ff69c9;
  color:white;
  font-size:16px;
}

.tiles{
  display:flex;
  justify-content:center;
  gap:14px;
  margin-top:12px;
}
.tile{
  width:60px;height:60px;
  border-radius:16px;
  background:#ffe3f3;
  font-size:26px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 14px #ffb6e6;
}

.blend-bar{
  margin-top:18px;
  padding:24px 12px 36px;
  border:3px dashed #ff5fb8;
  border-radius:18px;
  position:relative;
  background:#fff5fc;
}
.blend-letter{
  font-size:34px;
  margin:0 10px;
}
.blend-letter.active{
  background:#ffd9f2;
  border-radius:10px;
  box-shadow:0 0 18px #ff4fb3;
}

#tracker{
  position:absolute;
  bottom:8px;
  height:14px;
  width:90px;
  background:#ff1493;
  border-radius:999px;
  box-shadow:0 0 24px #ff1493;
  display:none;
}

.word-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
  margin-top:14px;
}
.word-card{
  padding:18px;
  font-size:22px;
  border-radius:18px;
  background:#ffe6f6;
  text-align:center;
  box-shadow:0 0 14px #ffb6e6;
}
.progress{text-align:center;font-size:18px}
</style>
</head>

<body>

<h1>üå∏ Kiki Learns to Read üå∏</h1>

<div id="blendPanel" class="panel">
  <h2>Slide to Read</h2>
  <div id="wordDisplay" style="text-align:center;font-size:30px"></div>
  <div class="tiles" id="tiles"></div>
  <div class="blend-bar" id="blendBar">
    <div id="letters"></div>
    <div id="tracker"></div>
  </div>
</div>

<div id="findPanel" class="panel hidden">
  <h2>Find the Word</h2>
  <div id="findPrompt" style="text-align:center;font-size:22px"></div>
  <div class="word-grid" id="grid"></div>
</div>

<div id="sentencePanel" class="panel hidden">
  <h2>Read the Sentence</h2>
  <div id="sentenceText" style="text-align:center;font-size:24px"></div>
  <button onclick="readSentence()">Read</button>
</div>

<div class="progress">
‚≠ê Level: <span id="level">1</span>
</div>

<script>
// ---------- FEMALE TTS ONLY ----------
let femaleVoice=null;
speechSynthesis.onvoiceschanged=()=>{
  femaleVoice = speechSynthesis.getVoices().find(v =>
    v.lang.startsWith("en") &&
    !/male|fred|daniel|alex/i.test(v.name)
  );
};

function speakWord(text){
  if(!femaleVoice) return;
  const u=new SpeechSynthesisUtterance(text);
  u.voice=femaleVoice;
  u.rate=0.9;
  u.pitch=1.25;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// ---------- PHONICS ----------
function playPhoneme(l){
  return new Promise(res=>{
    const a=new Audio(`sounds/${l}.m4a`);
    a.onended=res;
    a.onerror=res;
    a.play();
  });
}

// ---------- CVC GENERATION ----------
const consonants=["b","c","d","f","g","h","j","k","l","m","n","p","r","s","t","v","w","y","z"];
const vowels=["a","e","i","o","u"];
let words=[];
consonants.forEach(c1=>{
  vowels.forEach(v=>{
    consonants.forEach(c2=>{
      words.push(c1+v+c2);
    });
  });
});
words=words.sort(()=>Math.random()-0.5);
let index=0;
function nextWord(){
  if(index>=words.length){
    words=words.sort(()=>Math.random()-0.5);
    index=0;
  }
  return words[index++];
}

// ---------- LEVEL SYSTEM ----------
let level=1, correct=0;
const levelSpan=document.getElementById("level");

function advance(){
  correct++;
  if(correct>=5){
    level++;
    correct=0;
    levelSpan.textContent=level;
    loadLevel();
  } else loadLevel();
}

// ---------- LOAD LEVEL ----------
let currentWord="";
function loadLevel(){
  blendPanel.classList.add("hidden");
  findPanel.classList.add("hidden");
  sentencePanel.classList.add("hidden");

  if(level===1){
    blendPanel.classList.remove("hidden");
    loadBlend();
  } else if(level===2){
    findPanel.classList.remove("hidden");
    loadFind();
  } else {
    sentencePanel.classList.remove("hidden");
    loadSentence();
  }
}

// ---------- BLEND ----------
function loadBlend(){
  currentWord=nextWord();
  wordDisplay.textContent=currentWord.toUpperCase();
  tiles.innerHTML="";
  letters.innerHTML="";
  currentWord.split("").forEach(l=>{
    const t=document.createElement("div");
    t.className="tile"; t.textContent=l;
    t.onclick=()=>playPhoneme(l);
    tiles.appendChild(t);

    const s=document.createElement("span");
    s.className="blend-letter"; s.textContent=l;
    letters.appendChild(s);
  });
}

let last=-1;
blendBar.addEventListener("touchmove",async e=>{
  e.preventDefault();
  const rect=blendBar.getBoundingClientRect();
  const x=e.touches[0].clientX-rect.left;
  tracker.style.display="block";
  tracker.style.left=Math.max(0,Math.min(rect.width-90,x-45))+"px";

  [...letters.children].forEach(async (el,i)=>{
    const r=el.getBoundingClientRect();
    if(e.touches[0].clientX>=r.left&&e.touches[0].clientX<=r.right){
      if(i!==last){
        el.classList.add("active");
        await playPhoneme(el.textContent);
        last=i;
        if(i===letters.children.length-1){
          setTimeout(()=>{
            speakWord(currentWord);
            advance();
          },300);
        }
      }
    }
  });
},{passive:false});

blendBar.addEventListener("touchend",()=>{
  tracker.style.display="none";
  last=-1;
  [...letters.children].forEach(l=>l.classList.remove("active"));
});

// ---------- FIND ----------
function loadFind(){
  currentWord=nextWord();
  findPrompt.textContent="Find: "+currentWord.toUpperCase();
  speakWord("Find "+currentWord);
  const opts=[currentWord,nextWord(),nextWord(),nextWord()].sort(()=>Math.random()-0.5);
  grid.innerHTML="";
  opts.forEach(w=>{
    const c=document.createElement("div");
    c.className="word-card"; c.textContent=w;
    c.onclick=()=>{
      if(w===currentWord){
        speakWord("Well done");
        advance();
      } else speakWord("Try again");
    };
    grid.appendChild(c);
  });
}

// ---------- SENTENCES ----------
const sight=["the","is","a","to"];
function loadSentence(){
  const w1=nextWord(), w2=nextWord();
  const s=`${sight[Math.floor(Math.random()*sight.length)]} ${w1} is a ${w2}`;
  sentenceText.textContent=s;
}
function readSentence(){
  speakWord(sentenceText.textContent);
}

loadLevel();
</script>

</body>
</html>