<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kiki Learns to Read</title>

<style>
body{
  font-family:"Arial Rounded MT Bold",Arial,sans-serif;
  background:#fff0fa;
  margin:0;
  padding:16px;
  max-width:480px;
  margin:auto;
}
h1,h2{text-align:center}

.mode-bar{
  display:flex;
  gap:8px;
  margin-bottom:14px;
}
.mode-bar button{
  flex:1;
  padding:12px;
  border:none;
  border-radius:14px;
  font-size:14px;
  background:#ffd3ec;
}
.mode-bar button.active{
  background:#ff69c9;
  color:white;
}

.panel{
  background:white;
  border-radius:18px;
  padding:14px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
  margin-bottom:16px;
}
.hidden{display:none}

.tiles{
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
  margin-top:12px;
}
.tile{
  width:56px;
  height:56px;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  background:#ffe3f3;
  box-shadow:0 0 12px #ffb6e6;
}

.blend-bar{
  margin-top:16px;
  padding:16px 10px 24px;
  border:3px dashed #ff5fb8;
  border-radius:18px;
  position:relative;
  overflow:hidden;
  background:#fff5fc;
}
.blend-letter{
  font-size:30px;
  margin:0 8px;
  position:relative;
}
.blend-letter.active{
  background:#ffd9f2;
  border-radius:8px;
  box-shadow:0 0 14px #ff4fb3;
}
.blend-letter::after{
  content:"";
  position:absolute;
  left:0; right:0;
  bottom:-6px;
  height:5px;
  background:transparent;
}
.blend-letter.active::after{
  background:#ff1493;
  box-shadow:0 0 10px #ff1493;
}

/* BIG finger tracker */
#tracker{
  position:absolute;
  bottom:2px;
  height:12px;
  width:80px;
  background:#ff1493;
  border-radius:999px;
  box-shadow:0 0 20px #ff1493;
  display:none;
}

.word-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin-top:12px;
}
.word-card{
  padding:16px;
  font-size:22px;
  border-radius:16px;
  background:#ffe6f6;
  text-align:center;
  box-shadow:0 0 12px #ffb6e6;
}
.stars{text-align:center;font-size:22px}
</style>
</head>

<body>

<h1>üå∏ Kiki Learns to Read üå∏</h1>

<div class="mode-bar">
  <button id="mType" class="active">Type & Blend</button>
  <button id="mSlide">Slide & Blend</button>
  <button id="mFind">Find the Word</button>
</div>

<!-- TYPE -->
<div id="pType" class="panel">
  <h2>Type & Blend</h2>
  <input id="typeInput" placeholder="c-a-t" style="width:100%;font-size:20px">
  <button onclick="typeBlend()">Blend</button>
</div>

<!-- SLIDE -->
<div id="pSlide" class="panel hidden">
  <h2>Slide to Read</h2>
  <div id="slideWord" style="text-align:center;font-size:28px"></div>
  <div class="tiles" id="slideTiles"></div>
  <div class="blend-bar" id="blendBar">
    <div id="blendLetters"></div>
    <div id="tracker"></div>
  </div>
</div>

<!-- FIND -->
<div id="pFind" class="panel hidden">
  <h2>Find the Word</h2>
  <p id="findPrompt" style="text-align:center;font-size:22px"></p>
  <div class="word-grid" id="findGrid"></div>
  <div class="stars">‚≠ê <span id="starCount">0</span></div>
</div>

<script>
// -------- MODE --------
const panels={type:pType,slide:pSlide,find:pFind};
function show(m){
  Object.values(panels).forEach(p=>p.classList.add("hidden"));
  panels[m].classList.remove("hidden");
  [mType,mSlide,mFind].forEach(b=>b.classList.remove("active"));
  document.getElementById("m"+m.charAt(0).toUpperCase()+m.slice(1)).classList.add("active");
}
mType.onclick=()=>show("type");
mSlide.onclick=()=>show("slide");
mFind.onclick=()=>show("find");

// -------- FEMALE TTS --------
let female=null;
speechSynthesis.onvoiceschanged=()=>{
  female=speechSynthesis.getVoices().find(v=>v.lang.startsWith("en")&&/Samantha|Karen|Moira|Serena/i.test(v.name));
};
function speak(t){
  const u=new SpeechSynthesisUtterance(t);
  u.voice=female; u.rate=.95; u.pitch=1.2;
  speechSynthesis.cancel(); speechSynthesis.speak(u);
}

// -------- PHONEME AUDIO --------
function playSound(l){
  const a=new Audio(`sounds/${l}.m4a`);
  a.onerror=()=>speak(l);
  a.play();
}

// -------- TYPE --------
function typeBlend(){
  const parts=typeInput.value.toLowerCase().split("-");
  let d=0;
  parts.forEach(p=>{setTimeout(()=>playSound(p),d);d+=600;});
  setTimeout(()=>speak(parts.join("")),d+200);
}

// -------- SLIDE --------
const words=["cat","pin","sun","map","dog"];
let current=words[Math.floor(Math.random()*words.length)];
slideWord.textContent=current.toUpperCase();
slideTiles.innerHTML="";
blendLetters.innerHTML="";
current.split("").forEach(l=>{
  const t=document.createElement("div");
  t.className="tile"; t.textContent=l;
  t.onclick=()=>playSound(l);
  slideTiles.appendChild(t);

  const s=document.createElement("span");
  s.className="blend-letter"; s.textContent=l;
  blendLetters.appendChild(s);
});

let lastIndex=-1, finished=false;
blendBar.addEventListener("touchmove",e=>{
  e.preventDefault();
  const rect=blendBar.getBoundingClientRect();
  const x=e.touches[0].clientX-rect.left;
  tracker.style.display="block";
  tracker.style.left=Math.max(0,Math.min(rect.width-80,x-40))+"px";

  [...blendLetters.children].forEach((el,i)=>{
    const r=el.getBoundingClientRect();
    if(e.touches[0].clientX>=r.left&&e.touches[0].clientX<=r.right){
      if(i!==lastIndex){
        [...blendLetters.children].forEach(l=>l.classList.remove("active"));
        el.classList.add("active");
        playSound(el.textContent);
        lastIndex=i;
        if(i===blendLetters.children.length-1&&!finished){
          finished=true;
          setTimeout(()=>speak(current),350);
        }
      }
    }
  });
},{passive:false});

blendBar.addEventListener("touchend",()=>{
  tracker.style.display="none";
  lastIndex=-1; finished=false;
  [...blendLetters.children].forEach(l=>l.classList.remove("active"));
});

// -------- FIND --------
const cvc=["cat","dog","sun","map","cap"];
const sight=["the","is","a","to"];
let stars=0;
function startFind(){
  const target=cvc[Math.floor(Math.random()*cvc.length)];
  findPrompt.textContent="Find: "+target.toUpperCase();
  speak("Find "+target);
  const opts=[target,...sight].sort(()=>Math.random()-.5);
  findGrid.innerHTML="";
  opts.forEach(w=>{
    const c=document.createElement("div");
    c.className="word-card"; c.textContent=w;
    c.onclick=()=>{
      if(w===target){stars++;starCount.textContent=stars;speak("Well done "+w);startFind();}
      else speak("Try again");
    };
    findGrid.appendChild(c);
  });
}
startFind();
</script>

</body>
</html>