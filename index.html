<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kiki Learns to Read</title>

<style>
body{
  font-family:"Arial Rounded MT Bold",Arial,sans-serif;
  background:#fff0fa;
  margin:0;
  padding:16px;
  max-width:480px;
  margin:auto;
}
h1,h2{text-align:center}

.panel{
  background:white;
  border-radius:18px;
  padding:16px;
  margin-bottom:18px;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
}
.hidden{display:none}

.tiles{
  display:flex;
  justify-content:center;
  gap:14px;
  margin-top:12px;
}
.tile{
  width:60px;height:60px;
  border-radius:16px;
  background:#ffe3f3;
  font-size:26px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 14px #ffb6e6;
}

.blend-bar{
  margin-top:18px;
  padding:24px 12px 36px;
  border:3px dashed #ff5fb8;
  border-radius:18px;
  position:relative;
  background:#fff5fc;
}
.blend-letter{
  font-size:34px;
  margin:0 10px;
}
.blend-letter.active{
  background:#ffd9f2;
  border-radius:10px;
  box-shadow:0 0 18px #ff4fb3;
}

#tracker{
  position:absolute;
  bottom:8px;
  height:14px;
  width:90px;
  background:#ff1493;
  border-radius:999px;
  box-shadow:0 0 24px #ff1493;
  display:none;
}

.word-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
  margin-top:14px;
}
.word-card{
  padding:18px;
  font-size:22px;
  border-radius:18px;
  background:#ffe6f6;
  text-align:center;
  box-shadow:0 0 14px #ffb6e6;
}

.progress{text-align:center;font-size:18px;margin-bottom:10px}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:14px;
  background:#ff69c9;
  color:white;
  font-size:16px;
}
</style>
</head>

<body>

<h1>üå∏ Kiki Learns to Read üå∏</h1>

<div class="progress">
Level: <span id="level">1</span> ‚≠ê Stars: <span id="starCount">0</span>
</div>

<!-- LEVEL 1 -->
<div id="blendPanel" class="panel">
  <h2>Slide to Read</h2>
  <div id="wordDisplay" style="text-align:center;font-size:30px"></div>
  <div class="tiles" id="tiles"></div>
  <div class="blend-bar" id="blendBar">
    <div id="letters"></div>
    <div id="tracker"></div>
  </div>
</div>

<!-- LEVEL 2 -->
<div id="findPanel" class="panel hidden">
  <h2>Find the Word</h2>
  <div id="findPrompt" style="text-align:center;font-size:22px"></div>
  <div class="word-grid" id="grid"></div>
</div>

<!-- LEVEL 3 -->
<div id="sentencePanel" class="panel hidden">
  <h2>Read the Sentence</h2>
  <div id="sentenceText" style="text-align:center;font-size:24px"></div>
  <button onclick="readSentence()">Read</button>
</div>

<!-- LEVEL 4 -->
<div id="storyPanel" class="panel hidden">
  <h2 id="storyTitle"></h2>
  <img id="storyImage" style="width:150px;display:block;margin:10px auto;">
  <div id="storyText" style="text-align:center;font-size:24px;margin:14px 0"></div>
  <button onclick="readStoryPage()">Read</button>
  <button onclick="nextStoryPage()" style="margin-top:10px;background:#ff9adf">Next ‚Üí</button>
</div>

<script>
// ---------- FEMALE TTS ONLY ----------
let femaleVoice=null;
speechSynthesis.onvoiceschanged=()=>{
  femaleVoice=speechSynthesis.getVoices().find(v=>
    v.lang.startsWith("en") && !/male|fred|alex|daniel/i.test(v.name)
  );
};
function speakWord(text){
  if(!femaleVoice) return;
  const u=new SpeechSynthesisUtterance(text);
  u.voice=femaleVoice;
  u.rate=0.9;
  u.pitch=1.2;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// ---------- PHONICS ----------
function playPhoneme(l){
  return new Promise(res=>{
    const a=new Audio(`sounds/${l}.m4a`);
    a.onended=res;
    a.onerror=res;
    a.play();
  });
}

// ---------- SAFE WORD LIST ----------
const WORDS=[
"cat","dog","sun","hat","bat","rat","mat","map","cap",
"pen","hen","bed","red","leg","jet","net",
"cup","bug","rug","jug","mud","bus",
"pig","dig","fig","log","hog","fog",
"box","fox","top","hop","pot",
"man","fan","can","pan","van",
"run","fun","bun","jam","ram"
];

let pool=[...WORDS].sort(()=>Math.random()-0.5);
let wIndex=0;
function nextWord(){
  if(wIndex>=pool.length){
    pool=[...WORDS].sort(()=>Math.random()-0.5);
    wIndex=0;
  }
  return pool[wIndex++];
}

// ---------- PROGRESS ----------
let level=1, correct=0, stars=0;
function save(){
  localStorage.setItem("kiki_level",level);
  localStorage.setItem("kiki_stars",stars);
}
function load(){
  level=Number(localStorage.getItem("kiki_level"))||1;
  stars=Number(localStorage.getItem("kiki_stars"))||0;
  levelSpan.textContent=level;
  starCount.textContent=stars;
}
function advance(){
  correct++;
  if(correct>=5){
    stars++; correct=0;
    starCount.textContent=stars;
    level++;
  }
  save();
  loadLevel();
}

// ---------- LEVEL LOAD ----------
function hideAll(){
  blendPanel.classList.add("hidden");
  findPanel.classList.add("hidden");
  sentencePanel.classList.add("hidden");
  storyPanel.classList.add("hidden");
}
function loadLevel(){
  hideAll();
  levelSpan.textContent=level;
  if(level===1){blendPanel.classList.remove("hidden");loadBlend();}
  else if(level===2){findPanel.classList.remove("hidden");loadFind();}
  else if(level===3){sentencePanel.classList.remove("hidden");loadSentence();}
  else{storyPanel.classList.remove("hidden");loadStory();}
}

// ---------- LEVEL 1 ----------
let currentWord="";
function loadBlend(){
  currentWord=nextWord();
  wordDisplay.innerHTML=`${currentWord.toUpperCase()}<br><img src="images/${currentWord}.png" width="120">`;
  tiles.innerHTML=""; letters.innerHTML="";
  currentWord.split("").forEach(l=>{
    const t=document.createElement("div");
    t.className="tile"; t.textContent=l;
    t.onclick=()=>playPhoneme(l);
    tiles.appendChild(t);
    const s=document.createElement("span");
    s.className="blend-letter"; s.textContent=l;
    letters.appendChild(s);
  });
}

let last=-1;
blendBar.addEventListener("touchmove",async e=>{
  e.preventDefault();
  const rect=blendBar.getBoundingClientRect();
  tracker.style.display="block";
  tracker.style.left=Math.min(rect.width-90,e.touches[0].clientX-rect.left-45)+"px";
  [...letters.children].forEach(async (el,i)=>{
    const r=el.getBoundingClientRect();
    if(e.touches[0].clientX>=r.left&&e.touches[0].clientX<=r.right&&i!==last){
      el.classList.add("active");
      await playPhoneme(el.textContent);
      last=i;
      if(i===letters.children.length-1){
        setTimeout(()=>{speakWord(currentWord);advance();},300);
      }
    }
  });
},{passive:false});
blendBar.addEventListener("touchend",()=>{
  tracker.style.display="none";
  last=-1;
  [...letters.children].forEach(l=>l.classList.remove("active"));
});

// ---------- LEVEL 2 ----------
function loadFind(){
  currentWord=nextWord();
  findPrompt.innerHTML=`Find: ${currentWord.toUpperCase()}<br><img src="images/${currentWord}.png" width="120">`;
  speakWord("Find "+currentWord);
  const opts=[currentWord,nextWord(),nextWord(),nextWord()].sort(()=>Math.random()-0.5);
  grid.innerHTML="";
  opts.forEach(w=>{
    const c=document.createElement("div");
    c.className="word-card"; c.textContent=w;
    c.onclick=()=>{w===currentWord?(speakWord("Well done"),advance()):speakWord("Try again");};
    grid.appendChild(c);
  });
}

// ---------- LEVEL 3 ----------
const sight=["the","is","a"];
function loadSentence(){
  const s=`${sight[Math.floor(Math.random()*3)]} ${nextWord()} is a ${nextWord()}`;
  sentenceText.textContent=s;
}
function readSentence(){speakWord(sentenceText.textContent);advance();}

// ---------- LEVEL 4 STORYBOOK ----------
const STORIES=[
{title:"The Cat",image:"cat.png",pages:["the cat is a cat","the cat is a pet","the cat is a cat"]},
{title:"The Dog",image:"dog.png",pages:["the dog is a dog","the dog is a pet","the dog can run"]},
{title:"The Sun",image:"sun.png",pages:["the sun is hot","the sun is up","the sun is hot"]}
];
let story=null, page=0;
function loadStory(){
  story=STORIES[Math.floor(Math.random()*STORIES.length)];
  page=0;
  storyTitle.textContent=story.title;
  storyImage.src="images/"+story.image;
  showPage();
}
function showPage(){
  storyText.textContent=story.pages[page];
  speakWord(storyText.textContent);
}
function readStoryPage(){speakWord(storyText.textContent);}
function nextStoryPage(){
  if(page<story.pages.length-1){page++;showPage();}
  else{speakWord("Well done reading!");advance();}
}

load();
loadLevel();
</script>

</body>
</html>